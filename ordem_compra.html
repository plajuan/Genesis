<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordem de Compras - Master Detail</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Estilos Customizados -->
    <style>
        .total-geral {
            font-weight: bold;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- Master Section -->
        <h2>Ordem de Compras</h2>
        <div class="card mb-4">
            <div class="card-body">
                <form>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="ordemNumero" class="form-label">Número da Ordem</label>
                            <input type="text" class="form-control" id="ordemNumero" value="OC-2025-001" readonly>
                        </div>
                        <div class="col-md-4">
                            <label for="fornecedor" class="form-label">Fornecedor</label>
                            <select class="form-select" id="fornecedor">
                                <option value="forn1">Fornecedor A</option>
                                <option value="forn2">Fornecedor B</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="dataEmissao" class="form-label">Data de Emissão</label>
                            <input type="date" class="form-control" id="dataEmissao" value="2025-03-22">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Detail Section -->
        <h3>Itens da Ordem</h3>
        <table class="table table-striped" id="itensTable">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Quantidade</th>
                    <th>Preço Unitário (R$)</th>
                    <th>Total (R$)</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- Linha inicial de exemplo -->
                <tr>
                    <td>
                        <select class="form-select produto">
                            <option value="prod1">Cimento (50kg)</option>
                            <option value="prod2">Tijolo Cerâmico</option>
                        </select>
                    </td>
                    <td><input type="number" class="form-control quantidade" value="10" min="1"></td>
                    <td><input type="number" class="form-control preco" value="25.00" step="0.01"></td>
                    <td class="total">250.00</td>
                    <td><button class="btn btn-danger btn-sm remove-row">Remover</button></td>
                </tr>
            </tbody>
        </table>

        <!-- Botão para adicionar linha -->
        <button class="btn btn-primary mb-3" id="addRow">Adicionar Item</button>

        <!-- Total Geral -->
        <div class="text-end">
            <span class="total-geral">Total Geral: R$ <span id="totalGeral">250.00</span></span>
        </div>
    </div>

    <!-- Bootstrap JS e Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JavaScript para interatividade -->
    <script>
        // Função para calcular o total da linha
        function calcularTotalLinha(row) {
            const quantidade = parseFloat(row.querySelector('.quantidade').value) || 0;
            const preco = parseFloat(row.querySelector('.preco').value) || 0;
            const total = quantidade * preco;
            row.querySelector('.total').textContent = total.toFixed(2);
            calcularTotalGeral();
        }

        // Função para calcular o total geral
        function calcularTotalGeral() {
            const totals = document.querySelectorAll('.total');
            let totalGeral = 0;
            totals.forEach(total => totalGeral += parseFloat(total.textContent) || 0);
            document.getElementById('totalGeral').textContent = totalGeral.toFixed(2);
        }

        // Adicionar nova linha
        document.getElementById('addRow').addEventListener('click', function() {
            const tbody = document.querySelector('#itensTable tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <select class="form-select produto">
                        <option value="prod1">Cimento (50kg)</option>
                        <option value="prod2">Tijolo Cerâmico</option>
                    </select>
                </td>
                <td><input type="number" class="form-control quantidade" value="1" min="1"></td>
                <td><input type="number" class="form-control preco" value="0.00" step="0.01"></td>
                <td class="total">0.00</td>
                <td><button class="btn btn-danger btn-sm remove-row">Remover</button></td>
            `;
            tbody.appendChild(newRow);
            adicionarEventosLinha(newRow);
            calcularTotalGeral();
        });

        // Remover linha
        function removerLinha(button) {
            button.closest('tr').remove();
            calcularTotalGeral();
        }

        // Adicionar eventos a uma linha
        function adicionarEventosLinha(row) {
            row.querySelector('.quantidade').addEventListener('input', () => calcularTotalLinha(row));
            row.querySelector('.preco').addEventListener('input', () => calcularTotalLinha(row));
            row.querySelector('.remove-row').addEventListener('click', function() {
                removerLinha(this);
            });
        }

        // Inicializar eventos na linha existente
        document.querySelectorAll('#itensTable tbody tr').forEach(adicionarEventosLinha);
    </script>
</body>
</html>
